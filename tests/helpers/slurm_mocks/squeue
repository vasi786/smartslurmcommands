#!/usr/bin/env bash
# prints a fixed set of jobs, respecting -h and -o and -u/-t minimally
set -euo pipefail
header=true
format="%i|%j|%T|%Z|%M|%S|%R|%P"  # match your lib/slurm.sh
user=""
state=""
while [[ $# -gt 0 ]]; do
  case "$1" in
    -h) header=false; shift ;;
    -o) format="$2"; shift 2 ;;
    -u) user="$2"; shift 2 ;;
    -t) state="$2"; shift 2 ;;
    *)  shift ;;
  esac
done

# fixture rows (JobID|JobName|State|WorkDir|Elapsed|Start|Reason|Partition)
rows=$'\
1001|foo_run|RUNNING|/w/dirA|00:12:34|2025-11-10T10:00:00|tcn[1-2]|genoa
1002|foo_old|RUNNING|/w/dirA|2-03:04:05|2025-11-08T09:00:00|tcn[5]|genoa*
1003|foo_pending|PENDING|/w/dirA|0:00|N/A|(Priority)|genoa
1582|bar_dep|PENDING|/w/dirB|0:00|N/A|(Dependency)|genoa
1012|bar_run|RUNNING|/w/dirB|00:00:05|2025-11-10T10:05:00|tcn[7]|genoa
1583|baz_long|RUNNING|/w/dirC|1-02:03:04|2025-11-09T08:00:00|tcn[3]|rome
1022|baz_short|RUNNING|/w/dirC|00:00:50|2025-11-10T10:10:00|tcn[4]|rome
1023|baz_fail|FAILED|/w/dirC|00:59|2025-11-10T09:50:00|N/A|rome
1031|alpha_test|RUNNING|/w/dirD|00:20:00|2025-11-10T09:40:00|tcn[8]|arm64
1032|alpha_other|PENDING|/w/dirD|0:00|N/A|(Dependency)|arm64
'


# apply crude state filter
if [[ -n "$state" ]]; then
  rows="$(awk -F'|' -v s="$state" 'toupper($3)==toupper(s)' <<<"$rows")"
fi

# ignore -u for mock

# print
if $header; then
  # emulate squeue header-ish if not `-h` (loose)
  echo "JOBID|NAME|STATE|WORKDIR|ELAPSED|START|REASON|PARTITION"
fi
echo "$rows"
